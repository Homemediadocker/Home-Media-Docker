"use strict";(self.webpackChunkdocker_docs=self.webpackChunkdocker_docs||[]).push([[9869],{1656:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var i=n(4848),r=n(8453);const s={id:"authentik-sso",title:"SSO with Authentik",description:"Authentik is a robust solution for an SSO that is highly configurable and easy to use once stood up. It supports MFA and can be used as a dashboard or landing page solution as well.",sidebar_position:75},o="Authentik",a={id:"authentik-sso",title:"SSO with Authentik",description:"Authentik is a robust solution for an SSO that is highly configurable and easy to use once stood up. It supports MFA and can be used as a dashboard or landing page solution as well.",source:"@site/docs/authentik-sso.mdx",sourceDirName:".",slug:"/authentik-sso",permalink:"/Home-Media-Docker/docs/authentik-sso",draft:!1,unlisted:!1,editUrl:"https://github.com/Homemediadocker/docs/edit/main/docs/authentik-sso.mdx",tags:[],version:"current",sidebarPosition:75,frontMatter:{id:"authentik-sso",title:"SSO with Authentik",description:"Authentik is a robust solution for an SSO that is highly configurable and easy to use once stood up. It supports MFA and can be used as a dashboard or landing page solution as well.",sidebar_position:75},sidebar:"tutorialSidebar",previous:{title:"Traefik (Reverse Proxy)",permalink:"/Home-Media-Docker/docs/traefik-reverse-proxy"},next:{title:"External Access",permalink:"/Home-Media-Docker/docs/external-access"}},d={},l=[{value:"Auth Support",id:"auth-support",level:2},{value:"Do I have to use it?",id:"do-i-have-to-use-it",level:2},{value:"Traefik Dependency",id:"traefik-dependency",level:3},{value:"Authentik Example Docker Compose",id:"authentik-example-docker-compose",level:3},{value:"Authentik Example <code>.env</code> file",id:"authentik-example-env-file",level:3}];function h(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"authentik",children:"Authentik"})}),"\n",(0,i.jsx)(t.p,{children:"Authentik is one of the better SSO products I tried. I have tried authelia and keycloak as well. Keycloak is a close second for me but I found Authentik to be much better maintained once I got it setup."}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Authentik is an open-source Identity Provider, focused on flexibility and versatility. With authentik, site administrators, application developers, and security engineers have a dependable and secure solution for authentication in almost any type of environment. There are robust recovery actions available for the users and applications, including user profile and password management. You can quickly edit, deactivate, or even impersonate a user profile, and set a new password for new users or reset an existing password."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"auth-support",children:"Auth Support"}),"\n",(0,i.jsx)(t.p,{children:"They support all of the major providers, such as OAuth2, SAML, LDAP, and SCIM, so you can pick the protocol that you need for each application."}),"\n",(0,i.jsx)(t.h2,{id:"do-i-have-to-use-it",children:"Do I have to use it?"}),"\n",(0,i.jsx)(t.p,{children:"Authentik is completely optional to enable, but when you do, note that only a few containers are setup for it out of the box. Some need to be manually configured, enabled through in-app plugins (like emby's LDAP plugin), or through a forward proxy and basic auth pass."}),"\n",(0,i.jsx)(t.h3,{id:"traefik-dependency",children:"Traefik Dependency"}),"\n",(0,i.jsxs)(t.p,{children:["This is not directly dependent on ",(0,i.jsx)(t.code,{children:"Traefik"})," to run; if you don't need traefik, then remove the ",(0,i.jsx)(t.code,{children:"- traefik"})," from the ",(0,i.jsx)(t.code,{children:"depends_on"})," section in the ",(0,i.jsx)(t.code,{children:"authentik-server"})," service."]}),"\n",(0,i.jsxs)(t.admonition,{title:"Head up!",type:"warning",children:[(0,i.jsx)(t.p,{children:"If you are running a project as large (or larger) than this one with multiple containers, note that you may get a container port conflict, much like Authentik and Portainer in this project."}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["They both expose similar ports - ",(0,i.jsx)(t.code,{children:"9000"})," and ",(0,i.jsx)(t.code,{children:"9443"})]}),"\n",(0,i.jsxs)(t.li,{children:["This project ",(0,i.jsx)(t.code,{children:".env"})," file already forcibly changes these ports for Authentik for you so you don't have to worry about port conflicts. I found them already for you!"]}),"\n"]})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Just Authentik Commands"}),"\n"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Type"}),(0,i.jsx)(t.th,{children:"Command"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Start"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"docker compose up authentik -d"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Shutdown"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"docker compose down authentik"})})]})]})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Once started, Authentik should be hit from this url:"}),"\n"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{}),(0,i.jsx)(t.th,{children:"URL"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Non-SSL"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"http://localhost:8000/",children:"http://localhost:8000/"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"via Reverse Proxy"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://authentik.localhost/",children:"https://authentik.localhost/"})})]})]})]}),"\n",(0,i.jsx)("img",{src:"/Home-Media-Docker/img/authentik-login-page.png",alt:"authentik-login-page"}),"\n",(0,i.jsx)("img",{src:"/Home-Media-Docker/img/authentik-application-page.png",alt:"authentik-application-page"}),"\n",(0,i.jsx)(t.h3,{id:"authentik-example-docker-compose",children:"Authentik Example Docker Compose"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yml",children:'services:\n  postgresql:\n    image: docker.io/library/postgres:12-alpine\n    restart: unless-stopped\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}"]\n      start_period: 20s\n      interval: 30s\n      retries: 5\n      timeout: 5s\n    volumes:\n      - ${DEFAULT_CONTAINER_DATA_LOCATION}/Authentik/db:/var/lib/postgresql/data\n    networks:\n      - zauthentik\n    environment:\n      POSTGRES_PASSWORD: ${PG_PASS:?database password required}\n      POSTGRES_USER: ${PG_USER:-authentik}\n      POSTGRES_DB: ${PG_DB:-authentik}\n    env_file:\n      - ./.env\n      - ../../.env\n    profiles:\n      - all\n      - authentik\n\n  redis:\n    image: docker.io/library/redis:alpine\n    command: --save 60 1 --loglevel warning\n    restart: unless-stopped\n    healthcheck:\n      test: ["CMD-SHELL", "redis-cli ping | grep PONG"]\n      start_period: 20s\n      interval: 30s\n      retries: 5\n      timeout: 3s\n    volumes:\n      - ${DEFAULT_CONTAINER_DATA_LOCATION}/Authentik/redis:/data\n    networks:\n      - zauthentik\n    profiles:\n      - all\n      - authentik\n\n  authentik-server:\n    image: ${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-latest}\n    container_name: authentik-server\n    restart: unless-stopped\n    command: server\n    environment:\n      AUTHENTIK_REDIS__HOST: redis\n      AUTHENTIK_POSTGRESQL__HOST: postgresql\n      AUTHENTIK_POSTGRESQL__USER: ${PG_USER:-authentik}\n      AUTHENTIK_POSTGRESQL__NAME: ${PG_DB:-authentik}\n      AUTHENTIK_POSTGRESQL__PASSWORD: ${PG_PASS}\n      # AUTHENTIK_HOST: http://authentik.${PROJECT_HOSTNAME}\n      AUTHENTIK_HOST_BROWSER: https://authentik.${PROJECT_HOSTNAME}\n\n    volumes:\n      - ${DEFAULT_CONTAINER_DATA_LOCATION}/Authentik/media:/media\n      - ${DEFAULT_CONTAINER_DATA_LOCATION}/Authentik/custom-templates:/templates\n    networks:\n      - zauthentik\n      - homelab\n    env_file:\n      - ./.env\n      - ../../.env\n    labels:\n      - "traefik.enable=true"\n      - "traefik.docker.network=home-media-docker_homelab"\n      - "traefik.http.routers.authentik-server.rule=Host(`authentik.${PROJECT_HOSTNAME}`)"\n      - "traefik.http.routers.authentik-server.entrypoints=https"\n      - "traefik.http.routers.authentik-server.tls=true"\n      - "traefik.http.routers.authentik-server.tls.certresolver=${TRAEFIK_TLS_CERTRESOLVER}"\n      - "traefik.http.routers.authentik-server.service=authentik-svc"\n      - "traefik.http.services.authentik-svc.loadBalancer.server.port=8000"\n    depends_on:\n      - postgresql\n      - redis\n      - traefik\n    profiles:\n      - all\n      - authentik\n\n  worker:\n    image: ${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-latest}\n    restart: unless-stopped\n    command: worker\n    environment:\n      AUTHENTIK_REDIS__HOST: redis\n      AUTHENTIK_POSTGRESQL__HOST: postgresql\n      AUTHENTIK_POSTGRESQL__USER: ${PG_USER:-authentik}\n      AUTHENTIK_POSTGRESQL__NAME: ${PG_DB:-authentik}\n      AUTHENTIK_POSTGRESQL__PASSWORD: ${PG_PASS}\n    # `user: root` and the docker socket volume are optional.\n    # See more for the docker socket integration here:\n    # https://goauthentik.io/docs/outposts/integrations/docker\n    # Removing `user: root` also prevents the worker from fixing the permissions\n    # on the mounted folders, so when removing this make sure the folders have the correct UID/GID\n    # (1000:1000 by default)\n    user: root\n    networks:\n      - zauthentik\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n      - ${DEFAULT_CONTAINER_DATA_LOCATION}/Authentik/media:/media\n      - ${DEFAULT_CONTAINER_DATA_LOCATION}/Authentik/certs:/certs\n      - ${DEFAULT_CONTAINER_DATA_LOCATION}/Authentik/custom-templates:/templates\n    env_file:\n      - ./.env\n      - ../../.env\n    depends_on:\n      - postgresql\n      - redis\n    profiles:\n      - all\n      - authentik\n'})}),"\n",(0,i.jsxs)(t.h3,{id:"authentik-example-env-file",children:["Authentik Example ",(0,i.jsx)(t.code,{children:".env"})," file"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-conf",children:'##### AUTHENTIK ######\n\n# .env (in ALL)\nDOCKERDIR=${DEFAULT_CONTAINER_DATA_LOCATION}  # CHANGEME\nPUID=${UID}               # CHANGEME\nPGID=${GID}               # CHANGEME\nTZ=${TIMEZONE}\nDOMAIN=${PROJECT_HOSTNAME}    # CHANGEME\n\n\n################################################################\n# PostgreSQL\n################################################################\nPOSTGRES_DB=pgauthentik\nPOSTGRES_USER=authentik\nPOSTGRES_PASSWORD=testing123\nPG_PASS=testing123\n\n\n################################################################\n# Authentik\n################################################################\nAUTHENTIK_REDIS__HOST=authentik_redis\nAUTHENTIK_LISTEN__HTTP=authentik-server:8000\nAUTHENTIK_LISTEN__HTTPS=authentik-server:8443\n\nAUTHENTIK_POSTGRESQL__HOST=authentik_postgresql\nAUTHENTIK_POSTGRESQL__NAME=$POSTGRES_DB\nAUTHENTIK_POSTGRESQL__USER=$POSTGRES_USER\nAUTHENTIK_POSTGRESQL__PASSWORD=$POSTGRES_PASSWORD\n\nAUTHENTIK_ERROR_REPORTING__ENABLED: "false"\nAUTHENTIK_SECRET_KEY=123123123123123123123123123123\n# WORKERS=2\n\n# SMTP Host Emails are sent to\nAUTHENTIK_EMAIL__HOST=smtp.gmail.com\nAUTHENTIK_EMAIL__PORT=587\n# Optionally authenticate (don\'t add quotation marks to your password)\nAUTHENTIK_EMAIL__USERNAME=CHANGEME@gmail.com\nAUTHENTIK_EMAIL__PASSWORD=/run/secrets/authelia_notifier_smtp_password\n# Use StartTLS\nAUTHENTIK_EMAIL__USE_TLS=false\n# Use SSL\nAUTHENTIK_EMAIL__USE_SSL=false\nAUTHENTIK_EMAIL__TIMEOUT=10\n# Email address authentik will send from, should have a correct @domain\nAUTHENTIK_EMAIL__FROM=CHANGEME@gmail.com\n\n#########################################################################################\n########## ENABLE MIDDLEWARES IF YOU WANT TO USE PROXY AUTHENTICATION ###################\n#########################################################################################\n# PROWLARR_AUTHENTIK_MIDDLEWARE="traefik.http.routers.${PROWLARR_CONTAINER_NAME}.middlewares=middlewares-authentik@file"\n# RADARR_AUTHENTIK_MIDDLEWARE="traefik.http.routers.${RADARR_CONTAINER_NAME}.middlewares=middlewares-authentik@file"\n# VAULTWARDEN_AUTHENTIK_MIDDLEWARE="traefik.http.routers.${VAULTWARDEN_CONTAINER_NAME}.middlewares=middlewares-authentik@file"\n# SONARR_AUTHENTIK_MIDDLEWARE="traefik.http.routers.${SONARR_CONTAINER_NAME}.middlewares=middlewares-authentik@file"\n# TRAEFIK_DASHBOARD_AUTHENTIK_MIDDLEWARE="traefik.http.routers.${TRAEFIK_CONTAINER_NAME}.middlewares=middlewares-authentik@file"\n\n\n################################################################\n# GeoIP\n################################################################\nGEOIPUPDATE_ACCOUNT_ID=CHANGEME\nGEOIPUPDATE_LICENSE_KEY=CHANGEME\nAUTHENTIK_AUTHENTIK__GEOIP=/geoip/GeoLite2-City.mmdb\nGEOIPUPDATE_EDITION_IDS=GeoLite2-City\nGEOIPUPDATE_FREQUENCY=8\n'})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(6540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);